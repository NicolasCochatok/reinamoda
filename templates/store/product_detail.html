{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block content %}
<section class="section-content padding-y bg">
  <div class="container">
    <div class="row">
      <!-- IMAGEN PRINCIPAL -->
      <aside class="col-md-6">
        <div class="card">
          {% if single_product.image %}
            <img src="{{ single_product.image.url }}" class="img-fluid" alt="{{ single_product.product_name }}">
          {% else %}
            <img src="{% static 'images/no-image.png' %}" class="img-fluid" alt="Imagen no disponible">
          {% endif %}
        </div>
      </aside>

      <!-- INFORMACIÓN DEL PRODUCTO -->
      <main class="col-md-6">
        <article class="product-info-aside">
          <h2 class="title text-dark">{{ single_product.product_name }}</h2>
          <div class="mb-3">
            <span class="price h4">${{ single_product.price }}</span>
          </div>

          {% if single_product.description %}
            <p>{{ single_product.description }}</p>
          {% endif %}

          <form action="{% url 'add_cart' single_product.id %}" method="post">
            {% csrf_token %}

            {% with single_product.variation_set.all as variations %}
              {% if variations %}
                {% if variations|filter_by_category:"color" %}
                  <div class="form-group">
                    <label>Color:</label>
                    <select name="color" class="form-control" required>
                      <option value="" selected>Elegí un color</option>
                      {% for color in variations|filter_by_category:"color" %}
                        <option value="{{ color.variation_value }}">{{ color.variation_value|capfirst }}</option>
                      {% endfor %}
                    </select>
                  </div>
                {% endif %}

                {% if variations|filter_by_category:"talla" %}
                  <div class="form-group">
                    <label>Talla:</label>
                    <select name="talla" class="form-control" required>
                      <option value="" selected>Elegí una talla</option>
                      {% for talla in variations|filter_by_category:"talla" %}
                        <option value="{{ talla.variation_value }}">{{ talla.variation_value|capfirst }}</option>
                      {% endfor %}
                    </select>
                  </div>
                {% endif %}
              {% endif %}
            {% endwith %}

            <button type="submit" class="btn btn-primary mt-3">Agregar al carrito</button>
          </form>
        </article>
      </main>
    </div>
  </div>
</section>
{% endblock %}