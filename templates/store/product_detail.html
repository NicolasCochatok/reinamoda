{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="section-content padding-y bg">
  <div class="container">
    <div class="card">
      <div class="row no-gutters">
        <aside class="col-md-6">
          <article class="gallery-wrap">
            <div class="img-big-wrap mainImage zoom-container">
              <center>
                {% if single_product.images.name %}
                  <img src="{{ single_product.images.url }}" alt="Imagen Principal">
                {% else %}
                  <img src="{% static 'images/no-image.png' %}" alt="Sin imagen">
                {% endif %}
              </center>
            </div>
          </article>
          <ul class="thumb">
            <li>
              {% if single_product.images.name %}
                <a href="{{ single_product.images.url }}" target="mainImage"><img src="{{ single_product.images.url }}" alt="Imagen del Producto"></a>
              {% else %}
                <a href="#"><img src="{% static 'images/no-image.png' %}" alt="Imagen del Producto"></a>
              {% endif %}
              {% for i in product_gallery %}
                <a href="{{ i.image.url }}" target="mainImage"><img src="{{ i.image.url }}" alt="Imagen del Producto"></a>
              {% endfor %}
            </li>
          </ul>
        </aside>

        <main class="col-md-6 border-left">
          <form action="{% url 'add_cart' single_product.id %}" method="POST">
            {% csrf_token %}
            <article class="content-body">
              <h2 class="title">{{ single_product.product_name }}</h2>

              <div class="rating-star">
                <span>
                  {% for i in "12345" %}
                    <i class="fa fa-star{% if single_product.averageReview < forloop.counter0 + 0.5 %}-o{% elif single_product.averageReview < forloop.counter %}-half-o{% endif %}" aria-hidden="true"></i>
                  {% endfor %}
                  <span> ({{ single_product.countReview }} Comentarios realizados)</span>
                </span>
              </div>

              <br>
              <div class="mb-3">
                <var class="price h4">$ {{ single_product.price }}</var>
              </div>

              <p>{{ single_product.description }}</p>

              <hr>
              <div class="row">
                <div class="item-option-select">
                  <h6>Escoge el color</h6>
                  <select class="form-control" name="color" required>
                    <option value="" disabled selected>Seleccionar</option>
                    {% for i in single_product.variation_set.colors %}
                      <option value="{{ i.variation_value|lower }}">{{ i.variation_value|capfirst }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="item-option-select">
                  <h6>Escoge la tallas</h6>
                  <select class="form-control" name="talla" required>
                    <option value="" disabled selected>Seleccionar</option>
                    {% for i in single_product.variation_set.tallas %}
                      <option value="{{ i.variation_value|lower }}">{{ i.variation_value|capfirst }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <hr>

              {% if single_product.stock <= 0 %}
                <h5>Lo lamentamos, este producto está fuera de stock</h5>
              {% else %}
                <button type="submit" class="btn btn-dorado">
                  <span class="text">Agregar al Carrito</span>
                  <i class="fas fa-shopping-cart"></i>
                </button>
              {% endif %}
            </article>
          </form>
        </main>
      </div>
    </div>

    <br>

    <div class="row">
      <div class="col-md-9">
        <form action="{% url 'submit_review' single_product.id %}" method="post">
          {% csrf_token %}
          <h5>Escribe tu reseña o comentario</h5>
          <br>

          <div class="">
            <label>¿Cómo calificarías este producto?</label>
            <div class="rate">
              {% for i in "10987654321" %}
                {% with val=i|floatformat:1 %}
                  <input type="radio" name="rating" value="{{ val|floatformat }}" id="rating{{ i }}">
                  <label for="rating{{ i }}" title="{{ val }}" class="{% if val|floatformat:'1'|floatformat:'0.5' != val %}half{% endif %}"></label>
                {% endwith %}
              {% endfor %}
            </div>
            <br>

            <label>Título del comentario:</label>
            <input type="text" class="form-control" name="subject">

            <br>
            <label>Comentario:</label>
            <textarea name="review" rows="4" class="form-control" placeholder="Escribe aquí tu reseña"></textarea>
            <br>

            {% if user.is_authenticated %}
              {% if orderproduct %}
                <input type="submit" value="Enviar reseña" class="btn btn-primary">
              {% else %}
                <p>¡Debes comprar este producto para dejar una reseña!</p>
              {% endif %}
            {% else %}
              <p>Para comentar debes estar registrado. <a href="{% url 'login' %}">Inicia sesión</a></p>
            {% endif %}
          </div>

          {% include 'includes/alerts.html' %}
        </form>

        <br>
        <header class="section-heading">
          <h3>Reseñas de compradores verificados</h3>
          <div class="rating-star">
            <span>
              {% for i in "12345" %}
                <i class="fa fa-star{% if single_product.averageReview < forloop.counter0 + 0.5 %}-o{% elif single_product.averageReview < forloop.counter %}-half-o{% endif %}" aria-hidden="true"></i>
              {% endfor %}
            </span>
          </div>
        </header>

        {% for review in reviews %}
          <article class="box mb-3">
            <div class="icontext w-100">
              <div class="text">
                <span class="date text-muted float-md-right">{{ review.updated_at }}</span>
                <h6 class="mb-1">{{ review.user.full_name }}</h6>
                <div class="rating-star">
                  <span>
                    {% for i in "12345" %}
                      <i class="fa fa-star{% if review.rating < forloop.counter0 + 0.5 %}-o{% elif review.rating < forloop.counter %}-half-o{% endif %}" aria-hidden="true"></i>
                    {% endfor %}
                  </span>
                </div>
              </div>
            </div>
            <div class="mt-3">
              <h6>{{ review.subject }}</h6>
              <p>{{ review.review }}</p>
            </div>
          </article>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
